#!/bin/sh
set -e

# The install script is now located in the same directory as the sentinel binary
INSTALL_SCRIPT="/usr/local/bin/install_tools.sh"

chmod +x "$INSTALL_SCRIPT"

# If the install is being run by a user with sudo, SUDO_USER will be set.
# We must run the dependency installer as the regular user, not as root.
if [ -n "$SUDO_USER" ]; then
    echo "Running dependency installation for user: $SUDO_USER"
    su - "$SUDO_USER" -c "$INSTALL_SCRIPT"
else
    # Fallback for direct root installations, though less common for user tools.
    # This might fail for tools like pipx which should not be run as root.
    echo "WARNING: Running dependency installation as root. This is not recommended."
    "$INSTALL_SCRIPT"
fi

echo "Sentinel post-installation complete."
echo "Please make sure your Go and pipx bin paths are in your shell's PATH."
echo "Example: export PATH=\$PATH:\$HOME/.local/bin:\$(go env GOPATH)/bin"

exit 0 